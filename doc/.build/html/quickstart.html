
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Quickstart &#8212; NRM  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css" />
    
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Libnrm" href="libnrm.html" />
    <link rel="prev" title="Welcome to NRM’s documentation!" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="libnrm.html" title="Libnrm"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to NRM’s documentation!"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NRM  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quickstart</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>Welcome to the quickstart guide for NRM. This document will guide you to get up
and running with running your computational jobs through the Node Resource
Manager(NRM).</p>
<section id="install">
<h2>Install<a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<section id="container-piece">
<h3>Container piece<a class="headerlink" href="#container-piece" title="Permalink to this headline">¶</a></h3>
<p>The NRM code now supports mapping slices on both Singularity containers and
NodeOS compute containers.</p>
<section id="nodeos">
<h4>NodeOS<a class="headerlink" href="#nodeos" title="Permalink to this headline">¶</a></h4>
<p>For NodeOScontainer usage, you need to install our container piece
on the system. On a production platform, this should be done by a sysadmin. On
a development platform, this can be acheived with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://xgitlab.cels.anl.gov/argo/containers.git
<span class="nb">cd</span> containers
make install
</pre></div>
</div>
</section>
<section id="singularity">
<h4>Singularity<a class="headerlink" href="#singularity" title="Permalink to this headline">¶</a></h4>
<p>For local singularity installation, refer to the <a class="reference internal" href="#singularity">Singularity</a> installation
page.</p>
</section>
</section>
<section id="nrm">
<h3>NRM<a class="headerlink" href="#nrm" title="Permalink to this headline">¶</a></h3>
<p>The NRM core components (the <cite>nrmd</cite> daemon and <cite>nrm</cite> client) can be installed
in multiple ways:</p>
<section id="using-spack">
<h4>using Spack<a class="headerlink" href="#using-spack" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>spack install nrm</p>
</div></blockquote>
</section>
<section id="using-nix">
<h4>using Nix<a class="headerlink" href="#using-nix" title="Permalink to this headline">¶</a></h4>
<p>NRM has a Nix package in our local package repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nix-env -f <span class="s2">&quot;https://xgitlab.cels.anl.gov/argo/argopkgs/-/archive/master/argopkgs-master.tar.gz&quot;</span> -iA nrm
</pre></div>
</div>
</section>
<section id="using-pip">
<h4>using Pip<a class="headerlink" href="#using-pip" title="Permalink to this headline">¶</a></h4>
<p>You should be able to get NRM and its dependencies on any machine with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install git+https://xgitlab.cels.anl.gov/argo/nrm.git
</pre></div>
</div>
<p>And entering the resulting virtual environment with <cite>pipenv shell</cite>.</p>
</section>
</section>
</section>
<section id="setup-launching-the-nrmd-daemon">
<h2>Setup: Launching the <cite>nrmd</cite> daemon<a class="headerlink" href="#setup-launching-the-nrmd-daemon" title="Permalink to this headline">¶</a></h2>
<p>NRM’s behavior is controlled by the <cite>nrmd</cite> userspace daemon.  The <cite>nrmd</cite> daemon
should be launched by the application framework in the background and manages
the resource arbitration on the machine.</p>
<p>The daemon is launched via <cite>nrmd</cite> and logs its output to <cite>/tmp/nrm_log</cite> by
default.</p>
<p>The <cite>nrm</cite> daemon is mainly configured
through its command-line options.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrmd <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-c FILE<span class="o">]</span> <span class="o">[</span>-d<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> <span class="o">[</span>--nrm_log NRM_LOG<span class="o">]</span> <span class="o">[</span>--hwloc HWLOC<span class="o">]</span>
            <span class="o">[</span>--argo_nodeos_config ARGO_NODEOS_CONFIG<span class="o">]</span> <span class="o">[</span>--perf PERF<span class="o">]</span>
            <span class="o">[</span>--pmpi_lib PMPI_LIB<span class="o">]</span> <span class="o">[</span>--argo_perf_wrapper ARGO_PERF_WRAPPER<span class="o">]</span>
            <span class="o">[</span>--singularity SINGULARITY<span class="o">]</span>
            <span class="o">[</span>--container-runtime <span class="o">{</span>nodeos,singularity<span class="o">}]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -c FILE, --configuration FILE
                        Specify a config json-formatted config file to
                        override any of the available CLI options. If an
                        option is actually provided on the command-line, it
                        overrides its corresponding value from the
                        configuration file.
  -d, --print_defaults  Print the default configuration file.
  -v, --verbose         increase output verbosity
  --nrm_log NRM_LOG     Main log file. Override default with the NRM_LOG
                        environment variable
  --hwloc HWLOC         Path to the hwloc to use. This path can be relative
                        and makes uses of the <span class="nv">$PATH</span> <span class="k">if</span> necessary. Override
                        default with the HWLOC environment variable.
  --argo_nodeos_config ARGO_NODEOS_CONFIG
                        Path to the argo_nodeos_config to use. This path can
                        be relative and makes uses of the <span class="nv">$PATH</span> <span class="k">if</span> necessary.
                        Override default with the ARGO_NODEOS_CONFIG
                        environment variable.
  --perf PERF           Path to the linux perf tool to use. This path can be
                        relative and makes uses of the <span class="nv">$PATH</span> <span class="k">if</span> necessary.
                        Override default with the PERF environment variable.
  --pmpi_lib PMPI_LIB   Path to the libnrm PMPI library used <span class="k">for</span> the power
                        policy. Override default with the PMPI environment
                        variable.
  --argo_perf_wrapper ARGO_PERF_WRAPPER
                        Path to the linux perf tool to use. This path can be
                        relative and makes uses of the <span class="nv">$PATH</span> <span class="k">if</span> necessary.
                        Override default with the PERFWRAPPER environment
                        variable.
  --singularity SINGULARITY
                        Path to the singularity command. Override default with
                        the SINGULARITY environment variable.
  --container-runtime <span class="o">{</span>nodeos,singularity<span class="o">}</span>
                        Choice of container runtime. Override default with the
                        ARGO_CONTAINER_RUNTIME environment variable.
</pre></div>
</div>
</section>
<section id="running-jobs-using-nrm">
<h2>Running jobs using <cite>nrm</cite><a class="headerlink" href="#running-jobs-using-nrm" title="Permalink to this headline">¶</a></h2>
<p>Tasks are configured using a JSON file called a manifest and started using the <cite>nrm</cite>
command-line utility. Here’s an example manifest that allocates two CPUS and
enables application progress monitoring with a one second rate limit.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>name: basic
version: <span class="m">0</span>.0.1
app:
  container:
    cpus: <span class="m">2</span>
    mems: <span class="m">1</span>
  perfwrapper: <span class="nb">true</span>
  monitoring:
    ratelimit: <span class="m">1000000000</span>
</pre></div>
</div>
<p>This manifest can be used in the following way to launch a command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ nrm run /path/to/manifest.yaml <span class="nb">echo</span> <span class="s2">&quot;foobar&quot;</span>
foobar
INFO:nrm:process ended: msg_up_rpc_rep_process_exit<span class="o">(</span><span class="nv">api</span><span class="o">=</span>u<span class="s1">&#39;up_rpc_rep&#39;</span>, <span class="nv">container_uuid</span><span class="o">=</span>u<span class="s1">&#39;b54f12ed-6418-4b32-b6ab-2dda7503a1c8&#39;</span>, <span class="nv">status</span><span class="o">=</span>u<span class="s1">&#39;0&#39;</span>, <span class="nv">type</span><span class="o">=</span>u<span class="s1">&#39;process_exit&#39;</span><span class="o">)</span>
INFO:nrm:command ended: msg_up_rpc_rep_process_exit<span class="o">(</span><span class="nv">api</span><span class="o">=</span>u<span class="s1">&#39;up_rpc_rep&#39;</span>, <span class="nv">container_uuid</span><span class="o">=</span>u<span class="s1">&#39;b54f12ed-6418-4b32-b6ab-2dda7503a1c8&#39;</span>, <span class="nv">status</span><span class="o">=</span>u<span class="s1">&#39;0&#39;</span>, <span class="nv">type</span><span class="o">=</span>u<span class="s1">&#39;process_exit&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>You have run your first nrm-enabled command. See the <span class="xref std std-doc">manifest
guide</span> for an in-depth description of the manifest file format.</p>
<p>The <cite>nrm</cite> command-line client can be used for a number of operations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrm <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-v<span class="o">]</span> <span class="o">{</span>run,kill,list,listen,setpower<span class="o">}</span> ...

positional arguments:
  <span class="o">{</span>run,kill,list,listen,setpower<span class="o">}</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -v, --verbose         verbose logging information
</pre></div>
</div>
<p>Start containerized tasks, using a container specification we refer to as an application <span class="xref std std-doc">manifest</span>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrm run <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-u <span class="o">[</span>UCONTAINERNAME<span class="o">]]</span> manifest <span class="nb">command</span> ...

positional arguments:
  manifest              manifest file to apply
  <span class="nb">command</span>               <span class="nb">command</span> to execute
  args                  <span class="nb">command</span> arguments

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -u <span class="o">[</span>UCONTAINERNAME<span class="o">]</span>, --ucontainername <span class="o">[</span>UCONTAINERNAME<span class="o">]</span>
                        user-specified name <span class="k">for</span> container used to attach
                        proceses
</pre></div>
</div>
<p>Listen for performance and power data:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrm listen <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-u UUID<span class="o">]</span> <span class="o">[</span>-f FILTER<span class="o">]</span>

optional arguments:
  -h, --help            show this <span class="nb">help</span> message and <span class="nb">exit</span>
  -u UUID, --uuid UUID  container uuid to listen <span class="k">for</span>
  -f FILTER, --filter FILTER
                        <span class="nb">type</span> of message to filter and prettyprint, <span class="k">in</span>
                        <span class="o">{</span>power,performance<span class="o">}</span>
</pre></div>
</div>
<p>List running tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrm list <span class="o">[</span>-h<span class="o">]</span>

optional arguments:
  -h, --help  show this <span class="nb">help</span> message and <span class="nb">exit</span>
</pre></div>
</div>
<p>Kill tasks:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: nrm <span class="nb">kill</span> <span class="o">[</span>-h<span class="o">]</span> uuid

positional arguments:
  uuid        uuid of the container

optional arguments:
  -h, --help  show this <span class="nb">help</span> message and <span class="nb">exit</span>
</pre></div>
</div>
<p>Set a node power target:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> usage: nrm setpower <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-f<span class="o">]</span> limit

 positional arguments:
   limit         <span class="nb">set</span> new power limit

 optional arguments:
   -h, --help    show this <span class="nb">help</span> message and <span class="nb">exit</span>
   -f, --follow  listen <span class="k">for</span> power changes


.. _Singularity: https://singularity.lbl.gov/install-request
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quickstart</a><ul>
<li><a class="reference internal" href="#install">Install</a><ul>
<li><a class="reference internal" href="#container-piece">Container piece</a><ul>
<li><a class="reference internal" href="#nodeos">NodeOS</a></li>
<li><a class="reference internal" href="#singularity">Singularity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nrm">NRM</a><ul>
<li><a class="reference internal" href="#using-spack">using Spack</a></li>
<li><a class="reference internal" href="#using-nix">using Nix</a></li>
<li><a class="reference internal" href="#using-pip">using Pip</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#setup-launching-the-nrmd-daemon">Setup: Launching the <cite>nrmd</cite> daemon</a></li>
<li><a class="reference internal" href="#running-jobs-using-nrm">Running jobs using <cite>nrm</cite></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to NRM’s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="libnrm.html"
                        title="next chapter">Libnrm</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/quickstart.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="libnrm.html" title="Libnrm"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to NRM’s documentation!"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">NRM  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Quickstart</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Argonne National Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>